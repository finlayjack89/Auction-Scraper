---
# ═══════════════════════════════════════════════════════════════════════
# SETUP TASKS (CatalogSetupCrew — runs once)
# ═══════════════════════════════════════════════════════════════════════

input_validation_error_handling:
  description: |-
    Perform comprehensive validation of the auction URL before processing.
    Test URL accessibility, inspect site structure to identify auction catalogs vs. error pages.
    Detect common auction platforms (Christie's, Sotheby's, Heritage, etc.) and provide
    platform-specific guidance.

    **CRITICAL — PAGINATION DETECTION (this is essential for the next phase):**
    1. Scrape the first page of {auction_url}
    2. Find the TOTAL lot count (e.g. "245 lots", "Showing 1-60 of 510 lots")
    3. Count how many lots appear on the first page (this is lots_per_page)
    4. Look for pagination links in the scraped HTML/markdown:
       - "Next" links, "Page 2" links, numbered page links "1 2 3 4 5"
       - These are usually <a href="..."> elements in the page
    5. **Extract the EXACT href URL for page 2 from the HTML** — do NOT guess or construct it.
       Look for the actual link that the browser would follow when clicking "Page 2" or "Next".
       Copy the full URL exactly as it appears in the href attribute.
       Common parameters you might see: ?pn=2, ?page=2, ?p=2, ?pageNo=2, ?offset=60, /page/2
       DO NOT assume it is ?page=2 — look at the ACTUAL href in the HTML.
    6. Report the exact pagination URL pattern AND the full page 2 URL.
    7. Calculate total_pages = ceil(total_lots / lots_per_page)

    Note — keyword filtering is handled automatically by the system after extraction; you do not need to validate keywords.
  expected_output: |-
    Structured validation report with these EXACT fields (the system parses them):
    - url_status: ACCESSIBLE or BLOCKED or ERROR
    - platform_detected: platform name
    - requires_login: true or false
    - estimated_lots: number (TOTAL lots across ALL pages)
    - lots_per_page: number (lots visible on page 1)
    - pagination_detected: true or false
    - pagination_url_pattern: the EXACT URL parameter as found in the HTML href (e.g. "?pn=N" or "?page=N")
    - page_2_url: the FULL URL for page 2 — copied EXACTLY from the page 2 link href in the HTML
    - total_pages: number (calculated or observed)
    - validation_errors: []
    - recommendations: []

    IMPORTANT: page_2_url must be the ACTUAL URL from the HTML pagination link, not a URL you constructed yourself.
  agent: scout___auction_navigator_keyword_filter

discover_buyer_premium:
  description: |-
    **BUYER'S PREMIUM DISCOVERY** - Scrape the auction house website at {auction_url} to find the exact buyer's premium percentage and fee structure.

    **DISCOVERY STRATEGY:**
    1. **Navigate to Terms of Sale / Buyer's Premium page** on the auction house website
    2. **Look for links** labelled "Terms", "Conditions of Sale", "Buyer's Premium", "Charges", "Fees" from the auction page
    3. **Extract the buyer's premium percentage** — this is often tiered (e.g. 25% up to £500,000, then 20% above)
    4. **Determine if VAT is charged on the premium** (most UK auctions charge VAT on buyer's premium)
    5. **Identify any additional fees** (Artist Resale Rights / ARR, handling fees, etc.)

    **FALLBACK:** If the buyer's premium cannot be found on the website, default to 25% + VAT (20%) which is the most common UK rate.

    **OUTPUT MUST BE STRUCTURED** so downstream agents can use the exact rates in profit calculations.
  expected_output: 'Structured buyer premium report: {buyers_premium_rate: "25%",
    buyers_premium_tiered: true/false, tier_details: [{threshold: "£X", rate: "Y%"}],
    vat_on_premium: true/false, vat_rate: "20%", additional_fees: [], source_url: "URL
    where terms were found", discovery_method: "scraped/defaulted"}.'
  agent: scout___auction_navigator_keyword_filter
  context:
  - input_validation_error_handling

