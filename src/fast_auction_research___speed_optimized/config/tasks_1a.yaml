---
# ═══════════════════════════════════════════════════════════════════════
# SETUP TASKS (CatalogSetupCrew — runs once)
# ═══════════════════════════════════════════════════════════════════════

input_validation_error_handling:
  description: |-
    Perform comprehensive validation of the auction URL before processing.
    Test URL accessibility, inspect site structure to identify auction catalogs vs. error pages.
    Detect common auction platforms (Christie's, Sotheby's, Heritage, etc.) and provide
    platform-specific guidance.

    **CRITICAL — PAGINATION DETECTION (this is essential for the next phase):**
    - Scrape the first page of {auction_url}
    - Find the TOTAL lot count (e.g. "245 lots", "Showing 1-60 of 510 lots")
    - Count how many lots appear on the first page (this is lots_per_page)
    - Look for pagination links/buttons: "Next", "Page 2", page numbers "1 2 3 4 5"
    - Identify the URL pattern for page 2: does it use ?page=2, ?offset=60, ?pageNo=2, /page/2, or something else?
    - Report the EXACT pagination URL pattern AND the page 2 URL
    - Calculate total_pages = ceil(total_lots / lots_per_page)

    Note — keyword filtering is handled automatically by the system after extraction; you do not need to validate keywords.
  expected_output: |-
    Structured validation report with these EXACT fields (the system parses them):
    - url_status: ACCESSIBLE or BLOCKED or ERROR
    - platform_detected: platform name
    - requires_login: true or false
    - estimated_lots: number (TOTAL lots across ALL pages)
    - lots_per_page: number (lots visible on page 1)
    - pagination_detected: true or false
    - pagination_url_pattern: the URL parameter pattern, e.g. "?page=N" or "?offset=N" or "/page/N"
    - page_2_url: the FULL URL for page 2 (e.g. "https://example.com/auction/123?page=2")
    - total_pages: number (calculated or observed)
    - validation_errors: []
    - recommendations: []
  agent: scout___auction_navigator_keyword_filter

discover_buyer_premium:
  description: |-
    **BUYER'S PREMIUM DISCOVERY** - Scrape the auction house website at {auction_url} to find the exact buyer's premium percentage and fee structure.

    **DISCOVERY STRATEGY:**
    1. **Navigate to Terms of Sale / Buyer's Premium page** on the auction house website
    2. **Look for links** labelled "Terms", "Conditions of Sale", "Buyer's Premium", "Charges", "Fees" from the auction page
    3. **Extract the buyer's premium percentage** — this is often tiered (e.g. 25% up to £500,000, then 20% above)
    4. **Determine if VAT is charged on the premium** (most UK auctions charge VAT on buyer's premium)
    5. **Identify any additional fees** (Artist Resale Rights / ARR, handling fees, etc.)

    **FALLBACK:** If the buyer's premium cannot be found on the website, default to 25% + VAT (20%) which is the most common UK rate.

    **OUTPUT MUST BE STRUCTURED** so downstream agents can use the exact rates in profit calculations.
  expected_output: 'Structured buyer premium report: {buyers_premium_rate: "25%",
    buyers_premium_tiered: true/false, tier_details: [{threshold: "£X", rate: "Y%"}],
    vat_on_premium: true/false, vat_rate: "20%", additional_fees: [], source_url: "URL
    where terms were found", discovery_method: "scraped/defaulted"}.'
  agent: scout___auction_navigator_keyword_filter
  context:
  - input_validation_error_handling

